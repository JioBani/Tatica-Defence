# 2025-12-28 작업 기록

## TACD-16: StateBase 아키텍처 리팩토링 (이전 세션)

### 작업 내용

**상속 기반 → 인터페이스 기반으로 대대적 리팩토링**

1. **IStateListener 인터페이스 도입**
   - 기존: `StateBase<T>` 추상 클래스 상속
   - 변경: `IStateListener<T>` 인터페이스 구현
   - 명시적 인터페이스 구현 사용 (네이밍 충돌 방지)

2. **StateBase 래퍼 클래스 제거**
   - 불필요한 중간 래퍼 삭제
   - 직접 `StateBaseController<T>`에 리스너 등록/해제

3. **10개 이상의 State 구현 파일 삭제**
   - 각 State별 파일 구조 간소화
   - Enum → Controller → Listener 패턴으로 단순화

### 결과

- 코드베이스 대폭 단순화
- 타입 안전성 유지하면서 유연성 확보
- 유지보수성 향상

---

## TACD-72: 페이즈 전환 타이밍 및 UI 개선

### 작업 내용

1. **StateBaseController 개선**
   - `RequestStateChange`의 log 파라미터 제거
   - `DebugMode` 필드 추가로 디버깅 방식 개선

2. **RoundManager 페이즈 전환 타이밍**
   - Ready → Combat: 즉시 전환 → 3초 대기 후 전환
   - End → Maintenance: 즉시 전환 → 3초 대기 후 전환
   - UniTask 기반 비동기 전환 구현
   - Inspector에서 조정 가능한 duration 변수 추가

3. **RoundUiManager 신규 구현**
   - 모든 PhaseType별 UI 패널 표시
   - DOTween 스케일 애니메이션 (Ease.OutBack/InBack)
   - 애니메이션 충돌 방지: `DOComplete()` 사용

### 주요 이슈 및 해결

**문제**: 패널이 너무 빨리 사라짐
- 원인: 애니메이션 시간(0.5초) 미고려, 실제 표시 시간 1.5초
- 해결: `AutoHideAfterDelay`에 애니메이션 대기 추가

**문제**: 애니메이션 충돌 (End Exit → Maintenance Enter)
- 원인: 두 DOTween 애니메이션이 동시에 같은 transform 조작
- 해결: `DOComplete()` 사용 (DOKill()은 부자연스러움)

### 커밋

- `a1cfbad` - StateBaseController DebugMode 추가
- `e7971bf` - Ready/End 페이즈 전환 타이밍 UniTask로 개선
- `6c31b2d` - RoundUiManager 추가 및 페이즈별 UI 패널 구현
